import { glob } from 'glob'
// vite
import { defineConfig/*, splitVendorChunkPlugin*/ } from "vite";
import vitePluginCp from 'vite-plugin-cp'
// import dts from 'vite-plugin-dts'
import VitePluginCustomElementsManifest from 'vite-plugin-cem'
// unocss
import UnoCSS from 'unocss/vite'
import presetIcons from '@unocss/preset-icons'
import presetUno from '@unocss/preset-uno'
import presetTagify from '@unocss/preset-tagify'
import presetTypography from '@unocss/preset-typography'
import presetAttributify from '@unocss/preset-attributify'

const entries = glob.sync([
  'src/enibook.ts', 
  'src/enibook-autoloader.ts', 
  'src/elements/**/*.ts', 
  'src/utilities/**/*.ts'
])

export default defineConfig({
  plugins: [
    UnoCSS({
      mode: 'shadow-dom',
      include: ['./src/elements/**/*.ts', './src/utilities/**/*.ts'],
      presets: [
        presetUno(),
        presetAttributify(),
        presetTagify(),
        presetTypography(),
        presetIcons({
          extraProperties: {
            'display': 'inline-block',
            'vertical-align': 'middle',
            'width': '1em',
            'height': '1em'
          },
          prefix: 'it-',
          warn: true,    
        }),
      ],
    }),
    VitePluginCustomElementsManifest({
      files: glob.sync('./src/elements/**/*.ts'),
      lit: true,
      dev: true,
      packageJson: true,
      plugins: []
    }),
    vitePluginCp({
      targets: [
        { src: 'dist/', dest: '../docs/elements/dist/', flatten: false },
        { src: 'dist/custom-elements.json', dest: 'dev' },
      ],
    }),
    // dts(),
    // splitVendorChunkPlugin(),
  ],
  server: {
    open: 'dev/index.html',
  },
  build: {
    emptyOutDir: false,
    lib: {
      entry: entries, 
      name: 'enibook',
      fileName: 'enibook'
    },
    outDir: 'dist',
    rollupOptions: {
      output: {
        assetFileNames: 'enibook.css',
      }
    },
  },
  preview: {
    open: 'index.html',
  },
});